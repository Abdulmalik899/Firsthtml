/* PLEASE DO NOT COPY AND PASTE THIS CODE. */
if (typeof BotEmbedder == 'undefined') {
  window.BotEmbedder = (function () {
    let args =
        window[
          window["MtnBotObject"] ? window["MtnBotObject"] : window["VWBotObject"]
        ],
      el = null,
      host =
        typeof args.host != "undefined"
          ? args.host
          : "https://mtnng-prod.superbo.ai/bm/",
      defaultLocale = "en-US",
      appsrc = "api/bot/webcontainer",
      containerStyles = [host + "embed/embed.min.css?dt=20240715"],
      o = false,
      appendCss = function () {
        containerStyles.forEach(function (url) {
          let link = document.createElement("link");
          link.href = url;
          link.rel = "stylesheet";
          link.type = "text/css";
          try {
            document.head.appendChild(link);
          } catch (e) {}
        });
      },
      appendIframeCss = function () {
        document
          .getElementById("vw_web_widget_frame")
          .addEventListener("load", function (evt) {
            containerStyles.forEach(function (url) {
              let link = document.createElement("link");
              link.href = url;
              link.rel = "stylesheet";
              link.type = "text/css";
              try {
                evt.target.contentDocument.head.appendChild(link);
              } catch (e) {}
            });
          });
      },
      remove = function() {
        var container = document.getElementById("mtnbot-container");
        if (container) {
          container.remove();
        }
      },
      appendContainer = function () {
        el = document.createElement("div");
        el.id = "mtnbot-container";
        try {
          document.body.appendChild(el);
        } catch (err) {
          // console.error(err);
          el = null;
        }
      },
      appendApp = function () {
        if (!el || el.innerHTML) return false;
        let locale = localStorage.getItem("mtnbotlocale");
        if (!locale) {
          locale = defaultLocale;
        }
        appsrc += "?ch=" + args.ch + "&hl=" + locale;
        if (args.dn) appsrc += "&dn=" + args.dn;
        if (args.trigger_icon) appsrc += "&trigger_icon=" + args.trigger_icon;
        if (args.welcome_avatar)
          appsrc += "&welcome_avatar=" + args.welcome_avatar;
        if (args.conversation_avatar)
          appsrc += "&conversation_avatar=" + args.conversation_avatar;
        if (args.trigger_icon) appsrc += "&v=20211112T1436";
        if (args.texts)
          appsrc += "&texts=" + encodeURIComponent(JSON.stringify(args.texts));

        fetch(host + appsrc, {
          credentials: "same-origin"
        })
          .then((res) => {
            setTimeout(function () {
              try {
                el.classList.add("show");
                el.querySelector(".open-chatbox").classList.add("show");
                setTimeout(function () {
                  try {
                    el.classList.add("show_balloon");
                  } catch (e) {}
                }, 1500);
              } catch (e) {}
            }, 1000);
            return res.text();
          })
          .then((container) => {
            try {
              el.innerHTML = container;
              appendIframeCss();
              initEvents();
            } catch (e) {}
          });
      },
      // configureSize = function() {
      // 	if (!el)
      // 		return false;

      // 	let w = window.innerWidth,
      // 		h = window.innerHeight,
      // 		ew = el.querySelector('.mtnbot-modal').offsetWidth,
      // 		eh = el.querySelector('.mtnbot-modal').offsetHeight;
      // },
      initEvents = function () {
        if (!el) return false;

        o = el.querySelector(".mtnbot-modal").style.display == "block" ? 1 : 0;
        el.querySelector("button").addEventListener(
          "click",
          function (e) {
            if (!o) {
              el.querySelector(".mtnbot-modal").style.display = "block";
              // setTimeout(configureSize, 250);
              el.classList.add("opened");
              el.classList.remove("closed");
            } else {
              el.querySelector(".mtnbot-modal").style.display = "none";
              el.classList.remove("opened");
              el.classList.add("closed");
            }
            o = !o;
          },
          false
        );
        el.querySelector(".open-chatbox").addEventListener(
          "click",
          function (e) {
            if (!o) {
              el.querySelector(".mtnbot-modal").style.display = "block";
              // setTimeout(configureSize, 250);
              el.classList.add("opened");
              el.classList.remove("closed");
            } else {
              el.querySelector(".mtnbot-modal").style.display = "none";
              el.classList.remove("opened");
              el.classList.add("closed");
            }
            o = !o;
          },
          false
        );
        document
          .querySelector(".mtnbot-close-modal")
          .addEventListener("click", function (e) {
            el.querySelector(".mtnbot-modal").style.display = "none";
            el.classList.remove("opened");
            el.classList.add("closed");
            o = false;
          });
        window.addEventListener("click", function (e) {
          if (!el.contains(e.target)) {
            el.querySelector(".mtnbot-modal").style.display = "none";
            el.classList.remove("opened");
            el.classList.add("closed");
            o = !o;
          }
        });
        // window.addEventListener('resize', configureSize);
        // configureSize();
      };

    return {
      init: function () {
        if (
          typeof args !== "object" ||
          (args.ch && ["web", "mtnapp", "mobile", "eshop", "MTNWEBNXG", "captive_upstream", "captive_bemobi"].indexOf(args.ch) < 0)
        )
          return false;

        appendContainer();
        if (el) {
          appendCss(), appendApp();
        }
      },
      remove: function() {
        remove();
      }
    };
  })();
}

(function () {
  var callParams = window[
                                window["MtnBotObject"] ? window["MtnBotObject"] : window["VWBotObject"]
                              ];
  let callback = callParams["action"] != "remove"? BotEmbedder.init: BotEmbedder.remove;

  // in case the document is already rendered
  if (document.readyState != "loading") callback();
  // modern browsers
  else if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", callback);
  // IE <= 8
  else
    document.attachEvent("onreadystatechange", function () {
      if (document.readyState == "complete") callback();
    });
})();
