(function(B){function U(a,b){if(!Q(a)&&"object"!==typeof a&&Q(b))return a;a=Q(a)?{}:a;b=Q(b)?{}:b;if("object"!==typeof b)return b;var c={};"object"===typeof a&&F(a,function(k,g){c[g]=k});F(b,function(k,g){c[g]?R(c[g])&&R(b[g])?c[g]=c[g].concat(k):c[g]=U(c[g],k):c[g]=k});return c}function R(a){return"[object Array]"===Object.prototype.toString.call(a)}function N(a){return"undefined"===typeof a}function Q(a){return N(a)||null===a}function F(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,
c)&&b(a[c],c)}function V(){return(location.hostname.match(/^[\d.]+$|/)[0]||"."+(location.hostname.match(/[^.]+\.(\w{2,3}\.\w{2}|\w{2,})$/)||[location.hostname])[0]).replace(/^www\./i,"")}function da(a){if("object"!==typeof a)return a;if(R(a))return a.join(";");var b=[];F(a,function(c,k){R(c)?F(c,function(g){b.push(k+"\x3d"+g)}):b.push(k+"\x3d"+encodeURIComponent(c))});return b.join(";")}function W(a){a=JSON.parse('{"v":'+a+"}");return"v"in a?a.v:a}function S(a,b){function c(){for(var f=b.document.cookie.split(/;\s+/g),
n={},p=0;p<f.length;p++){var r=f[p].split(/[;=]/);1<r.length&&(n[r[0]]=r[1])}return n}var k=this,g=encodeURIComponent,e=decodeURIComponent;k.set=function(f,n,p,r){r||(n=g(n));var C=a.storage.domain||V();r=b.document;f=g(f)+"\x3d"+n+";domain\x3d"+C+";path\x3d/";p?(n=new b.Date,n.setTime(n.getTime()+864E5*p),p=";expires\x3d"+n.toGMTString()):p="";r.cookie=f+p+(a.storage.secure?";secure;sameSite\x3dnone":"");return k};k.remove=function(f){k.set(f,"",-1);return k};k.removeAll=function(f){if(f){var n=
c();F(n,function(p,r){(new RegExp("^"+f)).test(r)&&k.remove(e(r))})}};k.get=function(f,n){var p=new RegExp("(?:^|; )"+g(f).replace(/([.$?*|{}()[\]\\/+^])/g,"\\$1")+"\x3d([^;]+)");p=b.document.cookie.match(p);if(p){var r=p[1];r=n?r:e(r)}return r};k.getAll=function(f,n){if(f){var p=c();var r={};F(p,function(C,v){(new RegExp("^"+f)).test(v)&&(r[e(v)]=n?C:e(C))})}return r};return this}function X(a,b,c,k){function g(){return b.storage.prefix+"."+c+"."}c=("mmengine"===c?"e":null)||c||"def";this.get=function(e){var f=
g();if(!e){e=f.replace(/\./g,"\\.");e=a.getAll(e);var n=f.length,p={};F(e,function(r,C){p[C.substring(n)]=W(r)});return p}return(f=a.get(f+e))?W(f):f};this.set=function(e,f,n){var p=g();null===f||N(f)?a.remove(p+e):(f=JSON.stringify({v:f}),f=f.substring(5,f.length-1),n=N(n)?0:Math.min(b.storage.expiration,n),a.set(p+e,f,n));return this};this.removeAll=function(){a.removeAll(g().replace(/\./g,"\\."));return this}}function Y(a,b,c){function k(){return v.mergeParams(u[y.persistent].get(),v.mergeParams(u[y.deferredRequest].get(),
v.mergeParams(u[y.page].get(),u[y.request].get())))}function g(d){(d=r.getElementById(d))&&d.parentNode?d.parentNode.removeChild(d):d&&d.removeAttribute("src")}function e(d,h,m){var l=new XMLHttpRequest;l.open("POST",d);l.setRequestHeader("Accept","application/json");l.setRequestHeader("Content-Type","application/json");l.send(JSON.stringify({visitor_id:m,actions:h}))}function f(d,h){Object.prototype.hasOwnProperty.call(h,"un")&&"string"===typeof h.un&&(d=0===d.indexOf("http:")?d.substring(5):d,d=
0===d.indexOf("//")?"https:"+d:d);return d}function n(){var d={};return{get:function(h){return h?d[h]:d},set:function(h,m,l){0>parseInt(l)?delete d[h]:d[h]=m},removeAll:function(){d={}}}}this.ratingTrackingPage="ratingEvent";var p=1,r=c.document,C=0,v=this;v.mergeParams=U;this.conf=a;var u=[],y={persistent:0,deferredRequest:1,request:2,page:3},J=!0;this.request=function(d,h){var m="maxreco."+p;(function(z,w){c.json_response[z]=function(D){g(m);var A=!1,L=function(){if(!A){A=!0;var K=D&&D.PersistData||
[],O=D&&D.SystemData&&D.SystemData[0]&&D.SystemData[0].ResponseId||0;if(O>=C){for(var H=K.length-1;0<=H;H--)v.setParam(K[H].Name,K[H].Value,y.persistent,K[H].Expiration);C=O}w(!!D)}};N(void 0)?L():((void 0)(D,L),A||setAsync(!0));delete c.json_response[z]}})(p,h);var l={id:m,src:d},q=r.getElementsByTagName("head")[0],t=r.createElement("script");F(l,function(z,w){t.setAttribute(w,z)});q.insertBefore(t,q.lastChild);p++};this.clearStorage=function(){u[y.deferredRequest].removeAll();u[y.request].removeAll()};
this.DAPICall=function(d){try{var h=[],m=k();F(m.uv,function(l,q){for(var t=0;t<l.length;t++){var z=l[t].split(","),w={};w.type=q;w.product_id=z[1];w.count=z[0];h.push(w)}});e(this.conf.request.diapiServer+"projects/"+this.conf.recoWorkSpaceId+"/actions",h,d);this.clearStorage()}catch(l){ORA.Debug.error(l)}};this.CGCall=function(d,h){d=d||function(){};h=h||{};c.json_response=c.json_response||{};var m=v.mergeParams(this.dynamicParams(),k());m=v.mergeParams(m,h);var l=[];try{F(m,function(t,z){l.push(encodeURIComponent(z)+
"\x3d"+encodeURIComponent(da(t)))});this.clearStorage();var q=f(this.conf.request.server,m);this.request(q+l.join("\x26"),d)}catch(t){ORA.Debug.error(t)}};this.baseStorage=b.createBuilder();this.baseStorage.storeStrategy=y;this.dynamicParams=function(){var d="json_response["+p+"]",h={},m=c.screen;h.dmn=this.conf.site;h.cok=v.baseStorage.testStorage();h.scrh=m.height;h.scrw=m.width;h.lver=this.conf.version||"2.0";h.jsncl=d;h.ri=p;h.lto=-(new Date).getTimezoneOffset();h.jrt="s";return h};this.setParam=
function(d,h,m,l){u[m].set(d,h,N(l)?this.conf.storage.expiration:l);return this};this.getParam=function(d,h){return u[h].get(d)};this.removeParam=function(d,h){u[h].set(d,"",-1);return this};this.calcCookieDomain=this.conf.storage.domain||V();this.enable=function(){J=!0};this.isEnabled=function(){return J};this.disable=function(){J=!1};this.setLocalHistory=function(d,h,m){x=a.historyStoreMode;if("Cookie"!==x&&"Local Storage"!==x)ORA.Debug.debug("History Store mode Not Supported "+x);else{var l=new S(a,
c),q={},t={},z="";h=c.btoa(h);var w=null,D=null;try{var A=null,L=null;if(d&&d.toLowerCase().includes("view"))L="V";else if(d&&d.toLowerCase().includes("purchase"))L="P";else return;var K=Math.floor(Date.now()/1E3);if("Local Storage"===x)A=JSON.parse(localStorage.getItem(m)),(D=localStorage.getItem("recoTagMajorV"))||localStorage.removeItem("lastEventTime");else if("Cookie"===x){z=a.storage.prefix+"."+m;var O=l.get(z,!0);O&&(A=JSON.parse(O));(D=l.get(a.storage.prefix+".recoTagMajorV",!0))||E.set(a.storage.prefix+
".lastEventTime","",-1,!0)}if(A){A=this.convertToLatestFormat(A,D);t={};t[L]={D:K};q[h]=t;A.push(q);for(var H=JSON.stringify(A).length;1700<H;)A.splice(0,1),H=JSON.stringify(A).length;w=A}else t={},w=[],t[L]={D:K},q[h]=t,w.push(q);"Local Storage"===x?(localStorage.setItem(m,JSON.stringify(w)),localStorage.setItem("recoTagMajorV","4")):"Cookie"===x&&(l.set(z,JSON.stringify(w),a.storage.expiration,!0),l.set(a.storage.prefix+".recoTagMajorV","4",a.storage.expiration,!0));this.sendHistory(w)}catch(ea){ORA.Debug.debug(ea)}}};
this.sendHistory=function(d){var h="";if(d){for(var m=0;m<d.length;m++){var l=d[m],q;for(q in l)if(l.hasOwnProperty(q))for(var t in l[q])l[q].hasOwnProperty(t)&&(0<h.length&&(h+=";"),h=h+q+":"+t+":"+l[q][t].D)}d=h.split(";");l=m=h="";for(q=0;q<d.length;q++)if(t=d[q].length,490>=h.length+t)0<h.length&&(h+=";"),h+=d[q];else if(490>=m.length+t)0<m.length&&(m+=";"),m+=d[q];else if(490>=l.length+t)0<l.length&&(l+=";"),l+=d[q];else break;ORA.click({data:{"wt.tx_rechist1":h,"wt.tx_rechist2":m,"wt.tx_rechist3":l}})}};
this.convertToLatestFormat=function(d,h){if(h)"4"!==h&&ORA.Debug.debug("Not in the latest version");else{var m=new Map;for(q in d)if(d.hasOwnProperty(q))for(var l in d[q])d[q].hasOwnProperty(l)&&m.set(q+":"+l,d[q][l].D);if(m&&0<m.size){m=Array.from(m).sort(function(D,A){return D[1]-A[1]});var q=[];for(l=0;l<m.length;l++){var t=m[l][0].split(":"),z={},w={};w[t[1]]={D:m[l][1]};z[t[0]]=w;q.push(z)}return q}}return d};u[y.persistent]=v.baseStorage("p");u[y.deferredRequest]=v.baseStorage("d");u[y.request]=
n();u[y.page]=n();return this}function Z(a,b){function c(e,f,n,p){var r=b.getParam("uv",p)||{};e=e.replace(/^\s+|\s+$/gm,"");r[e]=r[e]||[];if(void 0===f)f=1;else if(""===f||isNaN(f))f=0,n="NaN";!n&&k?0<k.length&&r[e].push(f+(k?","+encodeURIComponent(k):"")):r[e].push(f+(n?","+encodeURIComponent(n):""));b.setParam("uv",r,p)}this.conf=a;var k=null,g=null;this.send=function(e,f,n){if(0<arguments.length&&e&&"string"===typeof e)this.setRating(e,f,n);else if(0!==arguments.length){ORA.Debug.error("You can't use rating.send without setting rating name");
return}this.hasRatings()&&b.isEnabled()?this.conf.request&&this.conf.request.diapiServer?b.DAPICall(g):b.CGCall(void 0,{pageid:b.ratingTrackingPage}):b.clearStorage()};this.setRating=function(e,f,n){!n&&k?(c(e,f,k,b.baseStorage.storeStrategy.request),b.setLocalHistory(e,k,"localHistory")):(c(e,f,n,b.baseStorage.storeStrategy.request),b.setLocalHistory(e,n,"localHistory"))};this.hasRatings=function(){var e=b.getParam("uv",b.baseStorage.storeStrategy.request)||{},f=b.getParam("uv",b.baseStorage.storeStrategy.deferredRequest)||
{};return"{}"!==JSON.stringify(e)||"{}"!==JSON.stringify(f)};this.set=function(e,f,n){if(!e||"string"!==typeof e)return ORA.Debug.error("You can't use rating.set without setting rating name."),this;this.setRating(e,f,n);return this};this.setPayload=function(e){k=e};this.setVisitorID=function(e){g=e}}function aa(a){this.config=a;this.scriptExecutor=function(b,c){var k=[];try{var g={};this.config&&this.config.Data&&this.config.Data.scripts&&(g=this.config.Data.scripts);for(var e=0;e<g.length;e++){a:{var f=
g[e],n=f.content,p=!1,r=!1,C=f.includeURLs,v=f.excludeURLs;if(C){for(var u=0;u<C.length;u++)if(C[u]){var y=B.location.href,J=new RegExp(C[u].replace(/\*|\?/g,".*").replace(/([$?|{}()[\]\\/+^])/g,"\\$1"),"g"),d=J.test(y);if(d){p=!0;break}}if(p&&v)for(u=0;u<v.length;u++)if(v[u]&&(y=B.location.href,J=new RegExp(v[u].replace(/\*/g,".*").replace(/([$?|{}()[\]\\/+^])/g,"\\$1"),"g"),d=J.test(y))){r=!0;break}if(p&&!r){var h=n;break a}}h=null}null!==h&&k.push(h())}ratings.setVisitorID(c);ratings.send()}catch(m){throw ORA.Debug.error(m),
m;}return k};this.afterInitExecutor=function(b){try{b={},this.config&&this.config.Extensions&&this.config.Extensions.afterInit&&(b=this.config.Extensions.afterInit),b()}catch(c){throw ORA.Debug.error(c),c;}return[]};return this}function T(a){function b(){try{I.scriptExecutor(!0)}catch(e){ORA.Debug.error("[ORA.recommender.executeCGCall.popStateHandler] Script Execution Error. Check Script "),console.log("[SpaHashHandler] Script Execution Error. Check Script ")}}a.spaTrackURL&&B.addEventListener("popstate",
b,!1);var c=document.querySelector(a.spaSelector?a.spaSelector:"body");if(c){var k={attributes:!0,attributeFilter:["src","href"],childList:!0,subtree:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0},g=new MutationObserver(function(){g.disconnect();try{I.scriptExecutor(!0)}catch(e){ORA.Debug.error("[ORA.recommender.executeCGCall.spaScriptExecuteCallback] Script Execution Error. Check Script ")}g.observe(c,k)});g.observe(c,k)}else ORA.Debug.error("[SPASupportl] Unsupported targetNode ")}
function ba(a,b,c){function k(){var g=(new Date).getTime().toString().slice(-5);b.set(a.storage.prefix+".tst",g,10);g=b.get(a.storage.prefix+".tst",!0)===g?1:0;b.remove(a.storage.prefix+".tst");return g}this.createBuilder=function(){var g=function(e){return new X(b,a,e,c)};g.isSecure=a.storage.secure;g.testStorage=k;return g}}ORA.recommender={};var I=null,E=null,ca=null,G=null,x=null,M=null,P=null;ORA.Event.RECO_PRODUCT_READY="recommender_product_ready";ORA.recommender.setup=function(){if(!B.recoInit){try{var a=
ORA.recommenderModule.prototype.oraConfigObj;x=a.historyStoreMode;ORA.Debug.debug("SetUp:  Setting Up Objects");E=new S(a,B);ca=new ba(a,E,B);G=new Y(a,ca,B);if(a.Extensions&&a.Extensions.beforeInit){var b=a.Extensions.beforeInit;b(G)}I=new aa(a);B.ratings=new Z(a,G);a.isSPA&&"scripts"===a.Data.Mode&&(ORA.Debug.debug("[ORA.recommender.setup]Setting up Spa support"),"complete"===document.readyState?(ORA.Debug.debug("Document is Ready, Setting up for SPA events"),T(a)):(ORA.Debug.debug("[ORA.recommender.setup]addEventListener to register for SPA"),
B.onload=function(){ORA.Debug.debug("Registered for SPA events");T(a)}));if(x){var c=a.storage.prefix+".localHistory",k=b=null;if("Cookie"===x)b=JSON.parse(localStorage.getItem("localHistory")),k=localStorage.getItem("recoTagMajorV"),b&&(ORA.Debug.debug("Moving from LS to Cookie"),E.set(c,JSON.stringify(b),a.storage.expiration,!0),k&&(E.set(a.storage.prefix+".recoTagMajorV",k,a.storage.expiration,!0),localStorage.removeItem("recoTagMajorV")),localStorage.removeItem("localHistory"),localStorage.removeItem("lastEventTime"));
else if("Local Storage"===x){var g=E.get(c,!0);g&&(b=JSON.parse(g));k=E.get(a.storage.prefix+".recoTagMajorV",!0);b&&(localStorage.setItem("localHistory",JSON.stringify(b)),E.set(c,"",-1,!0),E.set(a.storage.prefix+".lastEventTime","",-1,!0),k&&(localStorage.setItem("recoTagMajorV",k),E.set(a.storage.prefix+".recoTagMajorV","",-1,!0)),ORA.Debug.debug("Moving from Cookie to LS"))}}}catch(e){ORA.Debug.error(e)}if(I&&G.isEnabled())try{I.afterInitExecutor(!1)}catch(e){ORA.Debug.error("[ORA.recommender.executeCGCall] Script Execution Error. Check Script ")}B.recoInit=
!0;ORA.fireEvent(new ORA.Event(ORA.Event.RECO_PRODUCT_READY,ORA.Event.STATUS_SUCCESS))}};ORA.recommender.getClientIDAndExecute=function(a){I.scriptExecutor(!1,a)};ORA.recommender.executeCGCall=function(a,b,c,k,g){try{if(ORA.Debug.debug("executeCGCall:  Executing CGCall"),!G)ORA.Debug.debug("Loader is not initiliazed");else if(b){var e=b.split(";");a=null;if(k){if(a=k.toString().split(";"),e.length!==a.length){ORA.Debug.error("ProductID might have non Supported Character");return}}else if(1<e.length){ORA.Debug.error("ProductID might have non Supported Character");
return}c.toLowerCase().includes("view")&&(M=e[0],ORA.Debug.debug(M));g&&ratings.setVisitorID(g);for(g=0;g<e.length;g++)ratings.setPayload(e[g]),c&&ratings.set(c,k?a[g]:1);G.isEnabled()&&(ORA.Debug.debug("[ORA.recommender.executeCGCall] Sending Ratings "),ratings.send())}else if(I&&G.isEnabled())try{a.request&&a.request.diapiServer?ORA.common.clientID.getClientID(ORA.recommender.getClientIDAndExecute):I.scriptExecutor(!1)}catch(f){ORA.Debug.error("[ORA.recommender.executeCGCall] Script Execution Error. Check Script ")}}catch(f){ORA.Debug.error("[ORA.recommender.executeCGCall] failed")}};
ORA.recommender.getHistory=function(){var a=ORA.recommenderModule.prototype.oraConfigObj;x=a.historyStoreMode;var b=null,c=null,k=a.storage.prefix+".localHistory";x&&"Local Storage"===x?(b=JSON.parse(localStorage.getItem("localHistory")),c=localStorage.getItem("recoTagMajorV")):x&&"Cookie"===x&&((c=E.get(k,!0))&&(b=JSON.parse(c)),c=E.get(a.storage.prefix+".recoTagMajorV",!0));G&&(b=G.convertToLatestFormat(b,c));return b};ORA.recommender.popLastViewedProduct=function(){var a=M;M=null;return a};ORA.recommender.getLastViewedProduct=
function(){return M};ORA.recommender.setLastViewedProduct=function(a){M=a};ORA.recommender.setProductIDs=function(a){P="";if(a){var b="";if(Array.isArray(a))for(var c=0,k=0;k<a.length;k++){var g=a[k];if(g&&!(50<g.length)){if(10<=c)break;c++;b=""!==b?b+(";"+B.btoa(g)):B.btoa(g)}}else b=B.btoa(a);(P=b)&&ORA.click({data:{"wt.tx_recsku":P}})}};ORA.recommender.getProductIDs=function(){return new Promise(function(a,b){var c=0;(function g(){if(P){for(var e=P.split(";"),f=0;f<e.length;f++)e[f]=B.atob(e[f]);
return a(e)}c++;if(10<=c)return b();setTimeout(g,500)})()})};ORA.setExecuteState("recommender","ready");ORA.recommenderModule.CookieManager=S;ORA.recommenderModule.Loader=Y;ORA.recommenderModule.Storage=ba;ORA.recommenderModule.CookieStorage=X;ORA.recommenderModule.SPASupport=T;ORA.recommenderModule.Rating=Z;ORA.recommenderModule.ScriptExecutor=aa;ORA.recommenderModule.Setup=ORA.recommender.setup;ORA.recommenderModule.ExecuteCGCall=ORA.recommender.executeCGCall;ORA.recommenderModule.GetHistory=ORA.recommender.getHistory;
ORA.recommenderModule.GetLastViewedProduct=ORA.recommender.getLastViewedProduct;ORA.recommenderModule.PopLastViewedProduct=ORA.recommender.popLastViewedProduct})(window);